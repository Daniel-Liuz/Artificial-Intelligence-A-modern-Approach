在本章中，我们不再将状态视为不可分割的“黑盒”，而是采用**因子化表示**（factored representation），将每个状态表示为一组变量，每个变量有自己的值。若所有变量的值满足其约束，则问题求解完毕。这样的形式化问题称为 **约束满足问题（Constraint Satisfaction Problem，CSP）**。

## 6.1 定义约束满足问题

约束满足问题(CSP)由 3 个部分组成，即 X、D 和 C。

- **X** 是变量集合，{X1, …, Xn}。
- **D** 是域集合，{D1, …, Dn}，每个变量有一个域。
(例如，布尔变量的域为{${true}, {false}$}。)
- **C** 是约束集合，由 ⟨scope,rel⟩对组成。

不同变量可以有不同大小的域。每个约束$C_j$ 由 ⟨scope,rel⟩对组成，其中 scope 是该约束中的变量元组，而 rel 定义了这些值应该满足的关系（relation）。

例如，如果 $X_1$和$X_2$的域都是 $\{1, 2, 3\}$，那么约束“$X_1$必须大于$X_2$”可以表示为

$⟨(X1,X2),{(3,1),(3,2),(2,1)}⟩$

或

$⟨(X1,X2),X1>X2⟩$

### 一致与解的定义

在 CSP 中，我们会给每个变量分配一个值，而我们希望这些值满足约束条件。

1. **一致赋值（consistent assignment）**：指在给定的赋值中，没有任何一个变量的值违反了约束条件。换句话说，给定的赋值没有冲突。
    
    例如，如果我们有约束“`X1` 必须大于 `X2`”，并且给定赋值 `X1 = 3` 和 `X2 = 2`，这就是一致赋值，因为 `X1 > X2` 符合约束。
    
2. **完整赋值（complete assignment）**：指每个变量都有一个值被赋予，而不是部分变量没有赋值。
    
    例如，如果有三个变量 `X1`、`X2` 和 `X3`，并且它们都有被赋予的值，那么这就是一个完整赋值。如果只有 `X1` 和 `X2` 被赋值，而 `X3` 没有值，那么这不是完整赋值。
    
3. **解（solution）**：一个解是一个完整且一致的赋值，即所有变量都有值，并且这些值满足所有约束条件。
    
    例如，假设我们有三个变量 `X1`、`X2` 和 `X3`，以及一系列约束。如果我们找到了一个赋值方案，`X1 = 2`，`X2 = 1`，`X3 = 3`，并且这些值满足所有约束，那么这个赋值方案就是一个解。
    
4. **部分解（partial solution）**：部分解是指一些变量已经被赋值且这些赋值是合法的，但并没有给所有变量赋值。
    
    例如，如果有四个变量 `X1`、`X2`、`X3` 和 `X4`，并且给了 `X1` 和 `X2` 赋值，而 `X3` 和 `X4` 还没有被赋值，这就是一个部分解。

CSP 是 NP 完全问题，但某些子类问题可以高效求解。

---
### 6.1.1 示例：地图着色问题

以澳大利亚地图为例：

- 变量：州和地区 `X = {WA, NT, Q, NSW, V, SA, T}`
- 域：`D = {red, green, blue}`
- 约束：相邻区域颜色必须不同

图示如下：
![[6-1澳大利亚地图.png]]
#### 约束集合
由于相邻区域的边界线有 9 段，所以有 9 个约束。我们可以将这些约束表示为：
```scss
C = {
  SA-WA, SA-NT, SA-Q, SA-NSW, SA-V,
  WA-NT, NT-Q, Q-NSW, NSW-V
}
```
这里我们使用了缩写。

例如，`SA-WA` 是 `((SA, WA), SA-WA)` 的缩写，其中 `SA-WA` 代表了 SA 和 WA 这两个相邻区域之间的约束。它的完整枚举可以表示为：
```scss
{(red, green), (red, blue), (green, red), (green, blue), (blue, red), (blue, green)}
```
这个约束的意思是，`SA` 和 `WA` 这两个区域的颜色必须不同，因此可以有六种合法的 `(SA, WA)` 组合。
#### 一个可能的解

通过给定合理的赋值，我们可以找到多个可能的解。一个示例解是：
```scss
{WA = red, NT = green, Q = red, NSW = green, V = red, SA = blue, T = red}
```
#### 优势

通过 **CSP（约束满足问题）** 的方式，我们可以有效地减少搜索空间。例如，一旦我们分配了 `SA = blue`，就能立刻得出结论，它的 5 个相邻区域的颜色都不能是 `blue`。这样可以显著减少不必要的计算，避免了大量无效的状态空间搜索。

例如，如果我们没有约束条件的话，必须考虑这 5 个相邻变量的所有 243 种可能赋值（即 `5^3 = 243`）。然而，由于有了约束条件，我们只需考虑 32 种赋值（即 `2^5 = 32`），计算量减少了 87%。

#### 约束图的可视化

将 CSP 可视化为 **约束图**（constraint graph）非常有用，图中的节点代表问题的变量，而图的边则连接那些受到同一约束的变量。约束图能帮助我们更直观地理解各个变量之间的约束关系。

图 6-1b（已展示）是澳大利亚地图着色问题的约束图，图中的每个节点表示一个区域，每条边表示相邻区域的约束。
![[6-1澳大利亚地图.png]]

### 6.1.2 问题示例：车间作业调度